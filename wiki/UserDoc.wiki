#summary An introduction to ManiaLive for users.
#labels Phase-Requirements,Phase-Deploy

<wiki:toc max_depth="2" />

= Requirements =

  * Php at minimum version *5.3.1*<br>with cURL extension enabled (since r194)
  * Windows or Linux System.
  * Trackmania Dedicated Server
  * Php SQLite Extension`*`


,,*only needed if Threading enabled.,,

= Installation =

== Fresh ==

For a fresh installation go to the Downloads page and get the latest ManiaLive package.<br>
In addition you also might want to download the Standard Plugins package.<br>
Extract the ManiaLive archive somewhere you have access to.<br>
To install the plugins, just extract them into the ManiaLive folder that you have just created.

== Upgrade ==

When using ManiaLive it will display priodic messages when there's a new version ready.<br>
If you want to upgrade to the new version without much effort, it is recommended to use the update script.<br>

=== Windows ===

Just go to the update folder and execute the update.bat

|| http://files.manialive.com/doc/0_update_win.png ||

=== Linux ===

On Linux we weren't able to serve you with a launcher script yet, because it fails possibility to interact with the console.<br>
You will need to execute the php file by hand:<br>
{{{
florian@ubuntu:~/ManiaLive$ cd update
florian@ubuntu:~/ManiaLive/update$ php update.php
###############################
# ManiaLive Updater
###############################

> Checking local ManiaLive version ...
> ManiaLive is at version 1830
> Checking remote ManiaLive version ...
> Remote ManiaLive is at version 2028
> Searching ManiaLive release package ...
> Downloading 'ManiaLive_1.0_r2028.zip' ...
> OK.

Everything is in place.
[local: 1830] ---> [remote: 2028]
Do you want to update ManiaLive now? (y/n):
}}}

If the command php is unkown, you can also try this to get the path to your php executable:
{{{
florian@ubuntu:~/ManiaLive/update$ which php
/usr/bin/php
florian@ubuntu:~/ManiaLive/update$ /usr/bin/php update.php
...
}}}

= First start =
To get you started very quickly most configuration is already done. In fact, if you are running a just downloaded Trackmania Dedicated Server and you haven't done any changes apart from setting a server name, you should already be good to go.
If you have made some small changes for example the xml-rpc port or the Super Admin Password you can use the command line configuration. Here are the parameters you can add in the launch script

 * --help: displays the ManiaLive command line help
 * --rpcport=xxx : xxx represents the xmlrpc to use for the connection to the server
 * --address=xxx : xxx represents the address of the server, it should be an IP address or localhost
 * --user=xxx : xxx represents the name of the user to use for the communication. It should be User, Admin or SuperAdmin
 * --password=xxx : xxx represents the password relative to --user Argument
 * --dedicated_cfg=xxx : xxx represents the name of the Dedicated configuration file to use to get the connection data. This file should be present in the Dedicated's config file.
 * --manialive_cfg=xxx : xxx represents the name of the ManiaLive's configuration file. This file should be present in the ManiaLive's config file.

Here is a sample of how to start a ManiaLive instance:

`php.exe bootstrapper.php --dedicated_cfg=dedicated_cfg.txt --manialive_cfg=config.ini`

= Introduction to Configuration =

Otherwise you might want to take a look into the config folder which is located inside the application root and find the config-example.ini. This file will define the whole configurable behaviour of ManiaLive and its plugins.<br>

|| http://files.manialive.com/doc/1_rename_config.png ||

ManiaLive will look for a config.ini by default. So if you install ManiaLive on your system for the first time, you need to copy and rename the example so that ManiaLive is able to find it.<br>
If you are familiar with programming, you should be able to understand how to make changes very easily, for those who don't, there are only a few types of elements you need to understand:

== Elements ==

To be interpreted correctly, each element has to be put on a single line and may itself not contain any line breaks.

=== Comment ===

The easiest of all is probably the comment.
Beginning with a semicolon at the first character of the line and whatever text afterwards, it is used for making descriptions or formatting.
{{{
; This is a line of the configuration that will be ignored.
}}}
=== Assignment ===
An assignment can be made by just writing the option name onto the left side of an equality sign and the value you want to set for it on the right side. Some options expect text, some numbers and others may only be switches which you can set using “On” or “Off”.
{{{
config.logsPath = C:\Logs
}}}
=== Assigning more than one value ===
There are options which can take more than one value, for instance there might be an option to set the logins of the administrators that are allowed to control the server from an in-game interface. Using the global option style you would always overwrite the previously set value. To add another value to an option you simply add opening and closing brackets right after the name. This is not supported by every option, there should be comments with examples how to use each option.
{{{
manialive.admins[] = login1
manialive.admins[] = login2
}}}
=== Configuring Sub-Modules ===
Module and Option are divided by a simple full stop. Right after, without space, there follows the name of the setting. Then once again equals sign and the value you want to set. Previously defined rules apply.
{{{
server.port = 5000
}}}
=== Plugin Option ===
To configure plugins you to know the config classes for them. A widely used convention is to call it Config, so most the time you'll be able to it this way
{{{
ManiaLivePlugins\Author\Plugin\Config.message = 'Hello World'
}}}
For plugin configuration, you can also declare some aliases to make it easier. Those two lines are equivalent to the previous line
{{{
alias aplugin = ManiaLivePlugins\Author\Plugin\Config
aplugin.message = 'Hello World'
}}}
=== Host Overrides ===
Finally there's the possibility to add configuration that is only applied on a specific computer. “[hostname: aHost]” where aHost is the name of your computer on the local network. On windows you can get that name by simply typing “hostname” on the console.
Everything after this tag (until the next one) will be only executed on your machine.

= Startup Configuration =
Here you will find a short list of the available built in settings.

phpPath sets the path to your php executable file. If not set, then ManiaLive will use “php.exe” on Windows and “php” on Linux. Due to this, ManiaLive will not find it if you haven't added the php path to your system environment. You can then either do that, or overwrite phpPath to use the absolute path.

With the option logsPath you can define where ManiaLive will put all the log-files. Default value is the logs folder within the application root folder.

LogPrefix, if defined, puts this text in front of the name of every log-file that is created.

You can set runtimeLog, if you are running ManiaLive as a background daemon and you don't have direct console output, then this will forward everything that normally is written onto the screen into a file called log_Runtime. Depending on if you use logsPath or logsPrefix the path to or name of the file may differ.

globalErrorLog is a switch that can be “On” or “Off”.
If activated it will create an error-log in your logs folder “GlobalErrorLog.txt”. There is a error log for every ManiaLive instance that you start, the global error log will contain errors from all instances.

maxErrorCount sets the peak number of errors that may occur before the program is stopped.

== Module Configuration ==
=== Dedicated Server ===

Establishes the dedicated server connection and can be configured with the following options: server.host, server.port, server.user, server.password.

=== Administrators ===
The admins sub-module manages a list of administrators. You can add new admins to the logins list, by adding a line:
{{{
manialive.admins[] = 'login'
}}}

=== Plugins ===
Is a module, that dynamically loads plugins on application startup. Add a new plugin, that you want to load, by adding a line:
{{{
manialive.plugins[] = 'Author\Plugin'
}}}
Each plugin that is loaded needs to be located in the “ManiaLivePlugins” folder and has to have two sub-folders, one named after the author and one after the plugin itself.
In an author's folder there may be several plugin folders.

|| http://files.manialive.com/doc/3_plugins.png ||

=== Threading ===
This module will, if supported by the plugin, assign blocking or work with heavy calculations to other processes. This way the application's ability to respond is reserved.
If you are experiencing any problems, then try to disable threading on first step, the application then will switch in compatibility mode and will, very simple, try to emulate threading behaviour.
Options supported are: threading.enabled, threading.busyTimeout, threading.maxTries, threading.sequentialTimeout.

=== ManiaHome ===
You can enable this for creating a link between your server and ManiaHome. If you did, all achievements that are made on your server can be announced by plugins that are making use of this feature. This way, for instance, a plugin that manages records can inform all friends of a certain player that he just drove a new record on a server's track.
Options supported: maniahome.enabled, maniahome.user, maniahome.password, maniahome.manialink

= First Launch =
Within your ManiaLive folder there will be two launcher files. One for windows and one for linux systems.
<br>
If your php path is not set in your system environment, then you can set the path to it in the run.ini file (this applies to both, windows and linux)

|| http://files.manialive.com/doc/4_set_php.png ||

This path will be also used for threading, as long as you don't override it in the config.ini file.

== Windows ==
For windows you should be able to launch ManiaLive by simple double-clicking on “run.bat”.

== Linux ==
On linux it is almost the same.<br>
First you need to make the run file executeable.
{{{
florian@ubuntu:~$ cd ManiaLive
florian@ubuntu:~/ManiaLive$ chmod +x run
florian@ubuntu:~/ManiaLive$
}}}
Now you can use the script to start ManiaLive.
{{{
florian@ubuntu:~/ManiaLive$ ./run
Launching ManiaLive Daemon with the following arguments:
}}}
If you want to stop ManiaLive again, you can use a command line argument:
{{{
florian@ubuntu:~/ManiaLive$ ./run --stop
Stopping Manialive Daemon ...
}}}
Since you won't get any error when you are running ManiaLive as daemon (except you want to check the logs each time) you probably want to run it in the command line until it's stable.<br>
That can be achieved by another argument:
{{{
florian@ubuntu:~/ManiaLive$ ./run --nodaemon
Launching ManiaLive with the following arguments:
[19:09:58] XML-RPC connection established
[19:09:58] Successfully authentified with XML-RPC server
[19:09:58|Dedimania] Starting authentication on server ...
[19:09:58|Dedimania] Please wait, opening session ...
}}}

== Troubleshooting ==

=== It is not safe to rely on the system's timezone settings. ===

You did not set a timezone in your php.ini file.<br>
An easy explanation on how to fix this is [http://blog.randell.ph/2010/04/15/warning-date-it-is-not-safe-to-rely-on-the-systems-timezone-settings/ here].

=== Fatal error: Exception thrown without stack frame in Unknown on line 0 ===

This exception can happen when shutting down ManiaLive on Linux while using the TeamSpeak plugin.

= Logging =
When there's an error, then usually the first thing that you want to do is to check the log-files. But where to find them?
If you haven't changed the config settings for log-files, then the default place is the “logs” folder in the ManiaLive root. By default it contains the “log_Command.txt” which keeps track of the chat commands that have been used on the server, “log_Error.txt” if there have been errors during execution and “Loader_pid.txt” documenting the load process of the config-file for every instance that has been launched.
If you have changed logsPath then all logs except the global error log and the loader logs will be created in this path. If you set a prefix then the names will vary.